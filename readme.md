# R3 Corda - 요약

## R3
여러 금융기관이 참여한 컨소시엄 
1. 분산원장인 코다 및 코다 플랫폼 개발
2. 컨소시엄 멤버 간의 프로젝트
3. 금융 서비스 개발

## Corda 
금융산업에 최적화된 분산원장 기술 / 블록체인보다 상위 개념
계약상태의 변화(evolution)를 거래당사자간 합의(consensus)를 통해 동일하게 기록/보관하는 분산 데이터베이스 기술

>### 특징
	- 통합적으로 공유되는 데이터가 없고, 실제 거래에 참여한 거래 상대방 또는 거래 감독기구만 데이터 접근 가능
	- 거래에 대한 인증/합의를 네트워크 차원이 아닌, 거래 상대방끼리 "개별 거래 단위"로 도출
	- 코다 네트워크는 감독기구에게 디폴트로 관찰 노드를 제공
	- 다양한 합의 매커니즘 제공
	- 인간언어와 법률언어, 스마트계약코드를 연결하는 명시적 링크를 기록
	- 주언어 kotlin, java 개발 가능

>### Corda 플랫폼
금융 업무에 기본적인 자산발생/기록, 고객인증정보등 기능 제공

>### 금융계약과의 비유

* 볼트(Valut) : 상태객체를 저장 (캐비넷)
* 상태객체(State object) : 법률문서와 계약코드의 레퍼런스를 기반으로 하는 데이터 보관 (종이)
* 오라클(Oracle) : 계약에 필요한 정확한 외부 정부를 제공 (기상청)
* 거래(Transaction) : 상태객체의 업데이트를 계약코드를 통해 실행 (편지)
* 계약코드(Contract code) : 상태객체의 업데이트를 실행하는 법칙과 검증을 제공 (실행 내용)
* 플로우 매니저(Flow Manager) : 다양한 개체의 서명을 위해 계약의 상태정보를 명시 (대자보)
* 전자서명(Digital Signature) : 거래가 실제로 보낸 개체로부터 왔다는 사실을 증명하는 서명/부인방지 (서명)
* P2P messaging network : 거래를 안전하게 상대방에게 전달 (우체국 서비스)

>### 용어
* 상태(States) : 특정시간에 공유된 사실에 대한 데이터를 보관하는 객체
	- 속성 : 특정시간의 계약/자산의 상태를 반영
	- 참여자 : 트랙잭션 안의 상태를 소비하는 참여자
	- 계약 레퍼런스 : 트랙잭션의 검증 함수를 규정하는 계약을 가르킴

* 볼트(Vault) : 계약과 자산들이 저장되고 관리되는 DB. 상태 시퀸스의 헤드를 추적하고 보관.
* 거래(Transaction) : 원장을 업데이트하는 상태의 원자적 변화를 의미.
	- 비트코인과 같은 UTXO(Ubspend Transaction Output) 모델을 사용.
	- 원장은 소비되지 않은 상태의 집합이며, 트랜잭션의 아웃풋은 다음 트랙잭션의 인풋으로 사용될수 있다.
    - 원장을 업데이트하기 전 commit이 되어야 하는데, commit을 위해선 거래 참여자 모드 서명을 해야 한다. 
    - Fabric은 원장 업데이트를 위해서 각 피어들이 원장의 새 상태를 계산하는 코드(chain code)를 작성하고, 
      각 피어의 결과값을 비교한 후 원장을 업데이트 한다.
    - Coda는 거래의 제안자가 먼저 원장의 업데이트를 제안하고, 관련된 피어들에게 제안된 원장의 상태가 전달되면,
	  피어가 contract code를 통해 거래의 유효성을 검증한 후 서명하여 원장을 업데이트 한다.
      거래의 제안자가 아웃풋 상태를 반영하는 업데이트된 원장을 계산한다.
    - commit되는 필수조건
    	1. 이중지불을 포함하지 않는다
    	2. 계약상 유효해야한다
    	3. 당사자들에 의해 서명되었다
	- 시퀀스
		1. 발행 : 새로운 상태를 발행해 원장에 기록. 채굴 대신 참여기관이 직접 상태를 발생함.
    	2. 업데이트 : 새로운 상태로 변화하는 것.
			인풋 상태 레퍼런스 : 새로운 상태의 인풋은 기존의 아웃풋을 레퍼런스로 저장. 트랙잭션 ID와 Index로 구성. 	
    		트랜잭션 ID : 상태를 생성한 트랙잭션의 hash.
    		Index : 아웃풋 값들의 리스트에서 상태의 포지션.
		3. 종료 : 상태의 시퀀스를 끝냄으로써 원장에서 상태를 삭제하는 것.
* 계약(Contracts) : 원장을 업데이트하는 상태의 원자적 변화를 의미.
* 계약 레퍼런스 : 계약코드와 법률언어로 구성
* 계약 코드 : 트랙잭션을 검증하고 거래에 참여하는 모든 피어로부터 실행되어야 하는 코드. 
항상 동일한 아웃풋의 출력을 보장.
* 법률 언어 : 거래과장에서의 문제를 법적으로 해소하고, 체결된 거래가 법적으로 용인시키기 위해 필요. 
실제 법률계약서와 계약의 변수를 해싱하여 도출된 hash값.


>### Codar Network 구조
* Network
	- doorman service를 제공하고 node의 접근 허가(TLS certificate)를 제어한다. 
	- map service를 제공하고 network에 속한 node의 정보를 가지고 있다.
	- 하나이상의 notary service(공증)를 수행하는 node가 존재한다.
	- oracle service(거래서명)를 수행하는 node가 존재가 존재할 수 있다.
* Node
	- JVM run-time 환경에서 실행
	- node간 communication은 AMSP/1.0(TSL) base로 broacdcast가 아니라 p2p로 수행된다
* Notary 
 	- 이중지불을 방지한다.
 	- 선택적으로 거래 검증할 수 있다.
 	- node는 notary service를 제공할 수 있다.
 	- 합의 알고리즘은 선택 가능하다.(ex. RAFT, BFT)
* Doorman
	- node가 네트워크에 참여하려면 doorman 서버스에 요청한 정보를 제공해야하며, 
accept되면 root_authority_sigend TLS 인증서를 받게된다. 이 인증서는 다른 node와의 통신에서 자신을 증명하는데 사용된다.
* Map Service
	- network map은 모든 node에 배포된다
	- node는 network map service를 제공할 수 있다.

>### Node
>* DB는 default로 H2 사용. postgreSQL/SQLServer 사용 가능
>* shell 제공. ssh로 접속 가능
>* 구성

![Minion](https://docs.corda.r3.com/_images/node-diagram.png)


>### Contract
>* 검증코드와 state object, commands로 구성
